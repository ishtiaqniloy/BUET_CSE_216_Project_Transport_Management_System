DROP TABLE TRANSPORTMANAGEMENT.APPLICATION ;

CREATE TABLE TRANSPORTMANAGEMENT.APPLICATION (
APPLICATION_NUMBER NUMBER(25) NOT NULL ,
DRIVER_NID NUMBER(25) NOT NULL ,
EXAM_DATE DATE NULL ,
RESULT VARCHAR2(255) NULL ,
DIV_ID NUMBER(25) NULL,
LICENSE_TYPE VARCHAR2(255) NULL,
PRIMARY KEY (APPLICATION_NUMBER)
)
NOCOMPRESS
;

ALTER TABLE TRANSPORTMANAGEMENT.APPLICATION ADD CONSTRAINT APPLICATION_DRIVER FOREIGN KEY (DRIVER_NID) REFERENCES TRANSPORTMANAGEMENT.DRIVER (DRIVER_NID) ON DELETE CASCADE;

Declare 
	counter NUMBER;
BEGIN
	counter := 1 ;

FOR R IN (SELECT DRIVER_NID , ISSUE_DATE  FROM LICENSE)
LOOP
	INSERT INTO APPLICATION(APPLICATION_NUMBER,DRIVER_NID,EXAM_DATE,RESULT) VALUES (counter, R.DRIVER_NID, R.ISSUE_DATE-30, 'Pass');
	counter := counter + 1;
END LOOP;
END;
/

UPDATE APPLICATION A
SET Div_ID = (SELECT L.DIV_ID FROM LICENSE L WHERE L.DRIVER_NID = A.DRIVER_NID);

UPDATE APPLICATION A
SET LICENSE_Type = (SELECT L.TYPE FROM LICENSE L WHERE L.DRIVER_NID = A.DRIVER_NID);
